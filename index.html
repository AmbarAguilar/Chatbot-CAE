
const host     =  'database-prep-desarrollo-alexa.cstdceb0lngz.us-east-2.rds.amazonaws.com';
const user     =  'admin';
const password =  'adminalexamysql';
const port     =  '3306';
const database =  'PREP';
const dialect  =  'mysql';

const Sequelize = require('sequelize')

const sequelize = new Sequelize(database, user, password, {
  host: host,
  port: port,
  dialect: dialect,
  define: {
      freezeTableName: true,
  },
  pool: {
      max: 5,
      min: 0,
      acquire: 30000,
      idle: 10000,
  },
  // <http://docs.sequelizejs.com/manual/tutorial/querying.html#operators>
  operatorsAliases: false,
})

sequelize
  .authenticate()
  .then(function(err) {
    console.log('ConecciÃ³n a la base de datos correctamente.');
  })
  .catch(function (err) {
    console.log('Hubo un erroral conectarse a la base de datos', err);
  });


    

const fetch = require("node-fetch");
const { ApolloServer, gql } = require('apollo-server');

const typeDefs = gql`

  type libro {
    title: String
    author: String
  }
  
  enum personajeEstatus {
    Alive
    Dead
    unknown
  } 
  type personaje {
    name: String
    id: ID
    status: personajeEstatus
    episodios : [String]
  }

  type candidato {
    name: String
    id: ID
  }
  
  #type candidatoBD {
  #  ID_CANDIDATO : ID! 
  #  ID_ESCENARIO = String
  #  NOMBRE_PROPIETARIO = String
  #  NOMBRE_SUPLENTE = String
  #}

  type Query {
    libros: [libro]
    personajes : [personaje]
    candidatos : [candidato]
    #candidatosBD : [candidatoBD]
    #candidatoBD(id: ID!): candidatoBD
  }
`;


const resolvers = {
  Query: {
    libros: () => libros,
    personajes: () => personajes,
    candidatos: () => candidatos
//    candidatosBD: () => db.C_CANDIDATOS.findAll(),
//    candidatoBD: async (obj, args, context, info) =>
//      db.C_CANDIDATOS.findByPK(args.id)
  }
};

const server = new ApolloServer({
  typeDefs,
  resolvers,
  playground: {
    endpoint: "/dev/graphql"
  }
});

server.listen().then(({ url }) => {
  console.log(`ðŸš€  Server ready at ${url}`);
});

// Esta es una colecciÃ³n de libros que podremos consultar
// el servidor GraphQL para. Un ejemplo mÃ¡s completo podrÃ­a recuperar
// de una fuente de datos existente como una API REST o una base de datos.
const libros = [
  {
    title: "Harry Potter and the Chamber of Secrets",
    author: "J.K. Rowling"
  },
  {
    title: "Jurassic Park",
    author: "Michael Crichton"
  },
  {
    title: "Titulo prueba",
    author: "Autor prueba"
  }
];

// datos simulados para personajes
const personajes = [
  {
    name: "Rick Sanchez",
    id: 1,
    status: "Alive",
    episodios: [
      "https://rickandmortyapi.com/api/episode/1",
      "https://rickandmortyapi.com/api/episode/2"
    ]
  },
  {
    name: "Morty Smith",
    id: 2,
    status: "Alive",
    episodios: [
      "https://rickandmortyapi.com/api/episode/1",
      "https://rickandmortyapi.com/api/episode/3"
    ]
  }
];

// datos simulados para episodios
const episodios = [
  {
    name: "Pilot",
    id: 1
  },
  {
    name: "Lawnmower Dog",
    id: 2
  }
];

// datos simulados para candidatos
const candidatos = [
  {
    name:"Candidato 1",
    id: 1
  },
  {
    name: "Candidato 2",
    id: 2
  },
  {
    name: "Candidato 3",
    id: 3
  }
];






//---------Funciones------------

function fetchEpisodes() {
  // More info about the fetch function? https://github.com/bitinn/node-fetch#json
  return fetch("https://rickandmortyapi.com/api/episode/")
    .then(res => res.json())
    .then(json => json.results);
}

function fetchEpisodeById(id) {
  return fetch("https://rickandmortyapi.com/api/episode/" + id)
    .then(res => res.json())
    .then(json => json);
}

function fetchEpisodeByUrl(url) {
  return fetch(url)
    .then(res => res.json())
    .then(json => json);
}

function fetchCharacters() {
  // More info about the fetch function? https://github.com/bitinn/node-fetch#json
  return fetch("https://rickandmortyapi.com/api/character/")
    .then(res => res.json())
    .then(json => json.results);
}

function fetchCharacterById(id) {
  // More info about the fetch function? https://github.com/bitinn/node-fetch#json
  return fetch("https://rickandmortyapi.com/api/character/" + id)
    .then(res => res.json())
    .then(json => json);
}

function fetchCharacterByUrl(url) {
  // More info about the fetch function? https://github.com/bitinn/node-fetch#json
  return fetch(url)
    .then(res => res.json())
    .then(json => json);
}
